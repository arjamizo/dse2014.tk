<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
	<title>DSE14 - Distributed Systems Engineering at TUD (Technische Universitaet Dresden) 2014</title>
	<script src="http://www.polymer-project.org/platform.js"></script>
	<link rel="import" href="http://www.polymer-project.org/components/polymer/polymer.html">
	<link rel="import" href="http://www.polymer-project.org/components/core-localstorage/core-localstorage.html">
	<link rel="import" href="http://www.polymer-project.org/components/paper-tabs/paper-tabs.html">
	<link href="http://www.polymer-project.org/components/core-icons/core-icons.html" rel="import">
	<link href="http://www.polymer-project.org/components/paper-item/paper-item.html" rel="import">
	<link rel="import" href="http://www.polymer-project.org/components/paper-menu-button/paper-menu-button.html">
	<link type="text/css" rel="stylesheet" href="css/simplelittle.css" />
	<link rel="import" href="http://www.polymer-project.org/components/paper-checkbox/paper-checkbox.html">
	<link rel="import" href="http://www.polymer-project.org/components/paper-fab/paper-fab.html">
	<link rel="import" href="http://www.polymer-project.org/components/core-icons/core-icons.html">
	<link rel="import" href="http://www.polymer-project.org/components/paper-icon-button/paper-icon-button.html">

</head>
<body>

	<polymer-element name="tabs-with-content">
		<template>
			<style type="text/css">
				section {
					position: absolute !important;
					top: -9999px !important;
					left: -9999px !important;
				}
				section.core-selected {
					position: static !important;
					top: 0px !important;
					left: 0px !important;
				}
			</style>
			<core-localstorage name="selectedTab" value="{{selected}}"></core-localstorage>
			<div horizontal layout>
				<div>
					<dse-menu icon="menu">
						<a href="https://www.facebook.com/groups/358462094314942/">Go to Facebook Group</a>
					</dse-menu>
				</div>
				<div flex>
					<paper-tabs selected="{{selected}}">
						<paper-tab>Useful informations</paper-tab>
						<paper-tab>Schedule (Google Calendar)</paper-tab>
						<paper-tab>DVB for Studentenheim</paper-tab>
					</paper-tabs>
				</div>
			</div>
			<core-selector selected="{{selected}}" flex layout vertical>
				<section flex layout vertical>
					<dse-useful/>
				</section>
				<section flex layout vertical>
					<div>
						<p>This is calendar created from the schedule available at http://inf.tu-dresden.de. Remember that you can add this to your own calendar with bottom <italic>(+) calendar</italic>.</p>
						<iframe src="https://www.google.com/calendar/embed?mode=AGENDA&amp;height=600&amp;wkst=1&amp;bgcolor=%23FFFFFF&amp;src=ue22r3b7iqtk41f373mg707f0k%40group.calendar.google.com&amp;color=%23125A12&amp;ctz=Europe%2FWarsaw" style=" border-width:0 " width="800" height="600" frameborder="0" scrolling="no"></iframe>
					</div>
				</section>
				<section>
					<p>This webpage shows you several offers from public transport, especially students living in Zellescher Weg or Wundtstrasse might find them very useful.</p>
					<dse-dvb from="Zelleschner" header="Studentheim to TUD"/>
				</section>
			</core-selector>
		</template>
	</polymer-element>

	<tabs-with-content vertical layout flex></tabs-with-content>

	<script>
		Polymer("tabs-with-content", {
			selected: 0,
			ready: function() {
			},
			attached: function() {
			},
			selectedChanged: function() {
			},
		});

	</script>

	<polymer-element name="dse-menu" extends="paper-menu-button">
		<template>
			<shadow></shadow>
		</template>
		<script>
			Polymer({
				focusAction: function(e) {
				}
			});
		</script>
	</polymer-element>

	<polymer-element name="dse-useful">
		<template>
			<link type="text/css" rel="stylesheet" href="css/simplelittle.css" />
			<table>
				<tbody>
					<core-localstorage name="understood" value="{{understood}}"></core-localstorage>
					<template repeat="{{entry, id in entries}}">
						<tr>
							<td>{{entry}}</td>
							<td>
								<paper-checkbox class="blue" checked="{{understood[id]}}"></paper-checkbox>
								<span style="display: none;">{{understood[id]?1:0}}</span>
							</td>
						</tr>
					</template>
				</tbody>
			</table>
		</template>
		<script>
			Polymer({
				entries: [
					'You can access your mail at https://msx.tu-dresden.de',
					'Eclipse is not only an astronomical phenomena, but also an IDE and even framework',
				],
				understood: [true, false]
			});
		</script>
	</polymer-element>

	<polymer-element name="dse-dvb" attributes="from to header">
		<template>
			<h1>{{header}}</h1>
			<paper-icon-button on-tap="{{refresh}}" icon="refresh"></paper-icon-button>
			<table>
				<tbody>
					<template repeat = "{{trip in trips}}">
						<tr><td>{{trip[0]}}</td> <td>{{trip[1]}}</td><td>{{trip[2]}}</td></tr>
					</template>
				</tbody>
			</table>
			<textarea>{{text}}</textarea>
		</template>
		<script>
			Polymer({
				attached: function() {this.refresh();},
				refresh: function() {
					var params = {
						'vaform[datum]': '23.10.2014',
						'vaform[startname]': 'Zelleschner', //Weg
						'vaform[startort]': 'Dresden',
						'vaform[starttype]': 'stop',
						'vaform[zeit]': '15:21',
						'vaform[zeittyp]': 'dep',
						'vaform[zielname]': 'Technische', //Universtat
						'vaform[zielort]': 'Dresden',
						'vaform[zieltype]': 'stop',
					};
					params = Object.keys(params).map(function(i, e){ return i+"="+params[i]; }).join(escape('&'))
					console.log(params)

					var form = "http://www.dvb.de/en/Timetable/Journey-planner/direkt.do"

					console.log(form+"?"+params)
					var url="http://query.yahooapis.com/v1/public/yql?format=json&callback=handleJSONP&q=select * from html where url = '" + (form + "?" + params) + "'";
					url += " and xpath='//*[@id=\"pdf_form\"]//*[@class=\"full trip\"]'";

					var handleJSONP = function () {
						console.log('handleJSONP', arguments)
						this.res = arguments[0].query.results;

						this.trips = this.res.table.map(function(e, i){
							var el=e.tbody.tr[0].td;
							console.log(Object.keys(el));
							return [(el[0] && el[0].strong) || '', el[4] && el[4].strong || '', el[4] && el[4].p || '']
						})

						this.text = JSON.stringify(this.res, null, 2);
					}.bind(this)

					window.handleJSONP = handleJSONP;

					console.log('attached', url, window.handleJSONP);

					document.body.appendChild((function(url) {
						var el = document.createElement('script');
						el.type="text/javascript";
						el.src=url;
						return el;
					})(url));
				}
			});
		</script>
	</polymer-element>

</body>
</html>